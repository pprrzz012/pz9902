"use strict";function rcube_elastic_ui(){var c,a,e,n,t,i,o,s,r,l,d,p,u,m,h,f,v=this,g="normal",b=!1,_=!1,w=rcmail.is_framed(),k={config:{standard_windows:rcmail.env.standard_windows,message_extwin:rcmail.env.message_extwin,compose_extwin:rcmail.env.compose_extwin,help_open_extwin:rcmail.env.help_open_extwin},checkboxes:0,small_screen_config:{standard_windows:!0,message_extwin:!1,compose_extwin:!1,help_open_extwin:!1}},x={},y=[],C=[],E={menu:$("#layout-menu"),sidebar:$("#layout-sidebar"),list:$("#layout-list"),content:$("#layout-content")},T={menu:$("a.task-menu-button"),back_sidebar:$("a.back-sidebar-button"),back_list:$("a.back-list-button"),back_content:$("a.back-content-button")};function L(e,t,a){var n=$('<li role="menuitem">');(e=a?S($(e),!0,"hidden-big hidden-large"):$(e).detach()).contents().filter(function(){3!=this.nodeType||$.trim(this.nodeValue).length||$(this).remove()}),e.is(".spacer")?n.addClass("spacer"):n.append(e),t.push(n)}function j(e){"string"==typeof e&&e.length||(e=$("h1.voice").text()||$("title").text()||""),E.content.find(".header > .header-title").text(e)}function z(e,t,a,n){$e()&&k.frame_nav&&function(e,t){if(e.match(/_action=(create|add)/)||e.match(/_nav=hide/))return $(k.frame_nav).addClass("hide-nav-buttons");var a,n=$("[data-list]",E.list).data("list");if(!n||!(a=rcmail[n]))return $(k.frame_nav).is(".hide-nav-buttons")&&!$(".buttons",k.frame_nav).children().length&&$(k.frame_nav).addClass("hidden");$(k.frame_nav).removeClass("hide-nav-buttons hidden"),(e=a.get_single_selection())&&(a.rows&&a.rows[e]&&!a.rows[e].expanded?a.expand_row(t,e):a.get_node&&(r=a.get_node(e))&&r.collapsed&&a.expand(e));var i,o,s=$("#"+rcmail.env.contentframe),r=$("a.button.next",k.frame_nav).off("click").addClass("disabled"),e=$("a.button.prev",k.frame_nav).off("click").addClass("disabled");((o=a.get_next())||rcmail.env.current_page<rcmail.env.pagecount)&&r.removeClass("disabled").on("click",function(){k.content_lock=!0,ce(s),o?a.select(o):(rcmail.env.list_uid="FIRST",rcmail.command("nextpage"))}),((i=a.get_prev())&&("*"!=i||"subscription_list"!=n)||1<rcmail.env.current_page)&&e.removeClass("disabled").on("click",function(){k.content_lock=!0,ce(s),i?a.select(i):(rcmail.env.list_uid="LAST",rcmail.command("previouspage"))})}(t,e),a&&!E.content.is(":visible")?k.last_selected=E.content[0]:a||k.last_selected==u||k.content_lock||(k.last_selected=u),U(),j(n&&a?n:null),k.content_lock=!1}function M(e){"large"!=g&&!k.content_lock&&e.force&&K(),k.content_lock=!1,e.title&&$(".header > .header-title",E.list).text(e.title)}function O(e){var t={};"addressbook"!=rcmail.env.task&&"mail"!=rcmail.env.task||(t.force=!0),"mail"!=rcmail.env.task||rcmail.env.action||(e="string"==$.type(e)?e:rcmail.env.mailbox,e=rcmail.env.mailboxes[e],t.title=e?e.name:""),M(t)}function S(t,e,a,n){var i=!0,o=$("<a>"),s=t.attr("id")||(new Date).getTime(),r=s+"-clone",l=t[0].className+(a?" "+a:"");return e?(a=t.data("popup"))&&(o.data({popup:a,"toggle-button":t.data("toggle-button")}),X(o[0]),i=!1,rcmail.register_menu_button(o[0],a)):(l=$.trim(l.replace("btn-primary","primary").replace(/(btn[a-z-]*|button|disabled)/g,"")),l+=" button"+(n?"":" disabled")),o.attr({id:r,href:"#",class:l}).append($('<span class="inner">').text(t.text())),i&&o.on("click",function(e){t.click()}),w&&!e?(o.data("target",t),C.push($.extend({button_id:r},D(t[0].id)))):(s=s,r=r,l=l.replace(" disabled",""),(s=D(s))&&rcmail.register_button(s.command,r,s.data.type,l,s.data.sel)),o}function D(e){var t,a,n;for(n in rcmail.buttons)for(t=0;t<rcmail.buttons[n].length;t++)if((a=rcmail.buttons[n][t]).id==e)return{command:n,index:t,data:a}}function I(){$("[data-list]").filter("ul,table").each(function(){var t,e,a,n,i,o=$(this),s=o.data("list");rcmail[s]&&rcmail[s].multiselect&&((n=(a=(e=o.parents("layout-sidebar,#layout-list,#layout-content").last()).find(".header")).find("ul")).length?(t=n.find("a.select").data("toggle-button"))&&(t=$("#"+t)):n=a,rcmail[s].enable_checkbox_selection(),t||(t=$("<a>").attr({class:"button selection disabled",role:"button",title:rcmail.gettext("select")}).on("click",function(){$(this).is(".active")&&o.toggleClass("withselection")}).append($('<span class="inner">').text(rcmail.gettext("select"))),n.is(".menu")?(t.prependTo(n).wrap('<li role="menuitem">'),E.content&&(i=S(t,!0,"hidden-big hidden-large"),$('<li role="menuitem">').append(i).appendTo("#toolbar-menu"),t=t.add(i))):(i=o.data("list-select-replace"))?$(i).replaceWith(t):(t.appendTo(n).addClass("icon"),e.is("#layout-sidebar")||t.addClass("toolbar-button"))),rcmail.addEventListener("listupdate",function(e){e.list&&e.list==rcmail[s]&&(e.rowcount?t.addClass("active").removeClass("disabled").attr("tabindex",0):t.removeClass("active").addClass("disabled").attr("tabindex",-1))})),b&&rcmail[s]&&("function"==typeof rcmail[s].draggable?rcmail[s].draggable("destroy"):"boolean"==typeof rcmail[s].draggable&&(rcmail[s].draggable=!1))}),window.MutationObserver&&$("[data-label-msg]").filter("ul,table").each(function(){function e(){var e,t=i.data("label-msg"),a=i.is("ul")?i:i.children("tbody");if(!rcmail.env.search_request&&!rcmail.env.qsearch&&t&&!a.children(":visible").length)return e=i.data("label-ext"),a=i.data("create-command"),!e||a&&!rcmail.commands[a]||(t+=" "+e),void n.text(t).removeClass("hidden");n.addClass("hidden")}var n=$('<div class="listing-info hidden">').insertAfter(this),i=$(this),t=function(){if(rcmail.busy||!i.is(":visible"))return setTimeout(t,250);clearTimeout(k.list_timer),k.list_timer=setTimeout(e,50)};new MutationObserver(t).observe(i[0],{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style"]}),t()}),"print"!=rcmail.env.action&&$("#attachment-list > li").each(function(){oe(this)});function t(e){"phone"==g&&rcmail.display_message(rcmail.gettext(e),"confirmation")}var e,a;rcmail.addEventListener("fileappended",function(e){e.attachment.complete&&(oe(e.item),"text/vcard"==e.attachment.mimetype&&rcmail.commands["attach-vcard"]&&t("vcard_attachments.vcardattached"))}).addEventListener("managesieve.insertrow",function(e){A(e.obj)}).addEventListener("add-recipient",function(){t("recipientsadded")}),rcmail.init_pagejumper(".pagenav > input"),"mail"==rcmail.task?("compose"==rcmail.env.action&&(rcmail.addEventListener("compose-encrypted",function(e){$("a.mode-html, button.attach").prop("disabled",e.active),$("a.attach, a.responses:not(.edit)")[e.active?"addClass":"removeClass"]("disabled")}),$("#layout-sidebar > .footer:not(.pagenav) > a.button").click(function(){$(this).is(".disabled")&&rcmail.display_message(rcmail.gettext("nocontactselected"),"warning")}),window.MutationObserver&&(e=$("#attachment-list"),a=function(){ne("attach",0<e.children().length)},new MutationObserver(a).observe(e[0],{childList:!0}),a())),rcmail.env.extwin||"compose"!=rcmail.env.action&&"show"!=rcmail.env.action||$("a.mail",E.menu).attr({"aria-disabled":!1,onclick:"return rcmail.command('list','',this,event);"}),"preview"!=rcmail.env.action&&"show"!=rcmail.env.action||$("a").filter('[href^="mailto:"]').each(function(){var a,n;n=(a=this).onclick,a.onclick=null,$(a).on("click",function(e,t){return t||se($("#mailto-menu"),a,e,n)})})):"settings"==rcmail.task&&(rcmail.addEventListener("identity-encryption-show",function(e){A(e.container)}),rcmail.addEventListener("identity-encryption-update",function(e){A(e.container)})),rcmail.set_env({thread_padding:"1.5rem",popup_width_small:1025,popup_width:1200}),rcmail.env.devel_mode&&window.less?less.pageLoadFinished.then(function(){q(),rcmail.env.compose_focus_elem&&$(rcmail.env.compose_focus_elem).focus()}):q();var n,i=rcmail.env.date_format_localized;i&&(n=function(e){$(e).filter(".datepicker").attr("placeholder",i),$(e).parent().find("select").each(function(){ue(this)})},$("input.datepicker").each(function(){n(this)}),rcmail.addEventListener("insert-edit-field",n))}function A(t){var e,a,n;t=t||document,$("input.button,button",t).not(".btn").addClass("btn").not(".btn-primary,.primary,.mainaction").addClass("btn-secondary"),$("input.button.mainaction,button.primary,button.mainaction",t).addClass("btn-primary"),$("button.btn.delete,button.btn.discard",t).addClass("btn-danger"),$.each(["warning","error","information","confirmation"],function(){var e=this;$(".box"+e+":not(.ui.alert)",t).each(function(){J(this,e,!0)})}),t!=document&&1==$(".popup",t).children().length&&((n=$(".popup",t).children().first()).is("img")?$(".popup",t).addClass("justified"):n.is("label")&&(e=n.find("input").detach(),a=n.detach(),(n=e.attr("id"))||e.attr("id",n="dialog-input-elastic"),$(".popup",t).addClass("formcontent").append($('<div class="form-group row">').append(a.attr("for",n).addClass("col-sm-2 col-form-label")).append($('<div class="col-sm-10">').append(e))),e.focus()));var i="input:not(.button,.no-bs,[type=button],[type=radio],[type=checkbox]),textarea";$(i,$(".propform",t)).addClass("form-control"),$("[type=checkbox]",$(".propform",t)).addClass("form-check-input"),$("select",t).addClass("form-control custom-select"),t!=document&&$(i,t).addClass("form-control"),$("table.propform",t).each(function(){var o=0,s=0,r=["sm",4,8];$(this).attr("class").match(/cols-([a-z]+)-(\d)-(\d)/)&&(r=[RegExp.$1,RegExp.$2,RegExp.$3]),$(this).find("> tbody > tr, > tr").each(function(){var e,t,a=$(this),n=["form-group","row"],i=a.children("td");2==i.length?(e=i.first(),t=i.last(),$("label",e).addClass("col-form-label"),e.addClass("col-"+r[0]+"-"+r[1]),t.addClass("col-"+r[0]+"-"+r[2]),1!=t.find("[type=checkbox]").length||t.find(".proplist").length?t.find("input:not([type=hidden]),textarea,radio,select").length?s++:(t.addClass("form-control-plaintext"),o++):(n.push("form-check"),t.find("a").length&&n.push("with-link"),s++),t.children(".datepicker")&&2==t.children("input").length&&t.addClass("datetime")):1==i.length&&i.css("width","100%"),a.addClass(n.join(" "))}),s<o&&$(this).addClass("text-only")}),$("td.input-group",t).each(function(){$(this).children().slice(1).addClass("input-group-append")}),$("fieldset.propform:not(.groupped) div.row",t).each(function(){var e=0<$("input:not([type=hidden]),select,textarea",this).length;e&&$(i,this).addClass("form-control"),$(this).children().last().addClass("col-sm-8"+(e?"":" form-control-plaintext")),$(this).children().first().addClass("col-sm-4 col-form-label"),$(this).addClass("form-group")}),$("fieldset.propform.groupped fieldset",t).each(function(){$(".row",this).each(function(){var e,t=0<$("input,select,textarea",this).length,a=$(this).children();t&&$(i,this).addClass("form-control"),a.length<2||((e=a.first()).is("select")?e.addClass("input-group-prepend"):e.wrap('<span class="input-group-prepend">').addClass("input-group-text"),t||a.last().addClass("form-control-plaintext"),$(".content",this).addClass("input-group-prepend input-group-append input-group-text"),$("a.deletebutton",this).addClass("input-group-text icon delete").wrap('<span class="input-group-append">'),$(this).addClass("input-group"))})}),$("fieldset.advanced",t).each(function(){var e=$(this).children(".propform").first();e.wrap($("<div>").addClass("collapse")),$(this).children("legend").first().addClass("closed").on("click",function(){e.parent().collapse("toggle"),$(this).toggleClass("closed")})}),$(".propform > .prop.block:not(.row)",t).each(function(){$(this).addClass("form-group row").each(function(){$("label",this).addClass("col-form-label").wrap($('<div class="col-sm-4">')),$("input,select,textarea",this).wrap($('<div class="col-sm-8">')),$(i,this).addClass("form-control")})}),$("td.rowbuttons > a",t).addClass("btn"),$("form.tabbed,div.tabbed",t).each(function(n,e){var i=[],t=$("<ul>").attr({class:"nav nav-tabs",role:"tablist"});$(this).addClass("tab-content").children("fieldset").each(function(e,t){var a=t.id||"tab"+n+"-"+e,e=$(t).data("navlink-class");$(t).addClass("tab-pane").attr({id:a,role:"tabpanel"}),a=$("<li>").addClass("nav-item").append($("<a>").addClass("nav-link"+(e?" "+e:"")).attr({role:"tab",href:"#"+a}).text($("legend",t).first().text()).click(function(e){return $(this).tab("show"),Z(e),!1})),$("legend",t).first().hide(),i.push(a)}),t.append(i).insertBefore(e),$("a.nav-link",t).first().click()}),$("input[type=file]:not(.custom-file-input)",t).each(function(){var t=rcmail.gettext("choosefile"+(this.multiple?"s":"")),e=$("<label>").attr({class:"custom-file-label","data-browse":rcmail.gettext("browse")}).text(t);$(this).addClass("custom-file-input").wrap('<div class="custom-file">'),$(this).on("change",function(){var e=t;this.files.length&&(e=this.files[0].name,1<this.files.length&&(e+=", ...")),$(this).next().text(e)}).parent().append(e)}),$("table:not(.table,.compact-table,.propform,.listing,.ui-datepicker-calendar)",t).filter(function(){return!$(this).parent().is(".propform")&&!$(this).parents(".message-htmlpart,.message-partheaders,.boxinformation,.raw-tables").length}).each(function(){var e=$(this).addClass("table");e.parent().addClass("table-responsive-sm"),e.find("thead").addClass("thead-default")}),$("input.pretty-checkbox, .propform input[type=checkbox], .form-check input, .popupmenu.form input[type=checkbox], .menu input[type=checkbox]",t).each(function(){de(this)}),$(t).is(".actionrow")&&$("input[type=checkbox]",t).each(function(){de(this)}),$(".input-group-combo > select",t).first().on("change",function(){function e(){t[t.next().is(":visible")?"removeClass":"addClass"]("alone")}var t=$(this);setTimeout(e,50),setTimeout(e,2e3)}).trigger("change"),$("#message-objects",t).children(":not(.ui.alert)").add(".part-notice").each(function(){var e=String($(this).removeClass("notice part-notice").attr("class")).split(/\s/)[0]||"warning";J(this,e),$(this).addClass("box"+e),$("a",this).addClass("btn btn-primary btn-sm")}),$(".error",t).addClass("is-invalid"),"login"==rcmail.env.task&&t==document&&($("#rcmloginsubmit").addClass("btn-lg text-uppercase w-100"),$("#login-form table tr").each(function(){var e=$("input,select",this),t=$("label",this),a=e.data("icon"),n=$("<i>").attr("class","input-group-text icon "+e.attr("name").replace("_",""));a&&n.addClass(a),$(this).addClass("form-group row"),t.parent().css("display","none"),e.addClass(e.is("select")?"custom-select":"form-control").attr("placeholder",t.text()).before($('<span class="input-group-prepend">').append(n)).parent().addClass("input-group input-group-lg")})),$("select:not([multiple])",t).each(function(){ue(this)})}function N(e){var i,t,a=[],n=$("#"+e.id).parent().is(".html-editor");e.config.plugins+=" autoresize",ve().touch&&(e.config.toolbar_items_size=null,e.config.toolbar="undo redo | insert | styleselect",e.config.plugins.match(/emoticons/)&&(e.config.toolbar+=" emoticons")),"mail"==rcmail.task&&"compose"==rcmail.env.action&&(i=$("#compose-content > form"),t=function(e){"Tab"==e.key&&e.shiftKey&&$("#compose-content > form").scrollTop(0)},a.push(function(e){e.on("keypress",t)}),$("#composebody").on("keypress",t),i.on("scroll",function(){var e=$(".mce-container-body",i),t=$(".mce-top-part",e),a=e.offset(),n=i.offset().top;a&&a.top-n<0?t.css({position:"fixed",top:n+"px",width:e.width()+"px"}):t.css({position:"relative",top:0,width:"auto"})}),$(window).resize(function(){i.trigger("scroll")})),n&&(e.config.toolbar="plaintext | "+e.config.toolbar,e.config.setup_callback=function(t){t.addButton("plaintext",{tooltip:rcmail.gettext("plaintoggle"),icon:"plaintext",onclick:function(e){rcmail.command("toggle-editor",{id:t.id,html:!1},"",e.originalEvent)&&$("#"+t.id).parent().removeClass("ishtml")}})}),rcmail.addEventListener("editor-load",function(e){$.each(a,function(){this(e.ref.editor)})})}function R(t){var e;$("ul",t.obj).addClass("menu listing iconized"),$(t.obj).addClass("popupmenu popover"),A(t.obj),$("input",t.obj).addClass("form-control"),$e()&&$(t.obj).is(".googie_window")&&(e=rcmail.gettext("close"),e=$("<a>").attr("class","button icon cancel").text(e).click(function(e){e.stopPropagation(),$(".popover-overlay").remove(),$(t.obj).hide()}),$('<h3 class="popover-header">').append(e).prependTo(t.obj),$(".popover-overlay").length||$("<div>").attr("class","popover-overlay").appendTo("body").click(function(){$(this).remove()}),$("ul,button",t.obj).click(function(e){$(e.target).is("input")||$(".popover-overlay").remove()}))}function P(a){if(w&&$.each(C,function(e,t){a.command==t.command&&parent.$("#"+t.button_id)[a.status?"removeClass":"addClass"]("disabled")}),"mail"==rcmail.task)switch(a.command){case"reply-list":var e;1==rcmail.env.reply_all_mode&&(e=rcmail.gettext(a.status?"replylist":"replyall"),$(".toolbar a.reply-all").attr("title",e).find(".inner").text(e));break;case"compose-encrypted":$(".toolbar a.encrypt").parent().show();break;case"compose-encrypted-signed":$("#encryption-menu-button").show()}}function W(){var e=$(window).width(),t=e<=480?"phone":1200<e?"large":768<e?"normal":"small";b=e<=1024,g=t}function q(){var e,t,a;W(),U(),t=ve(),(a=$(document.documentElement))[0].className.match(/layout-([a-z]+)/)?RegExp.$1!=t.mode&&a.removeClass("layout-"+RegExp.$1).addClass("layout-"+t.mode):a.addClass("layout-"+t.mode),t.touch&&!a.is(".touch")?a.addClass("touch"):!t.touch&&a.is(".touch")&&a.removeClass("touch"),(e=$e())?(rcmail.set_env(k.small_screen_config),rcmail.enable_command("extwin",!1)):(rcmail.set_env(k.config),rcmail.enable_command("extwin",!0)),$.each(y,function(){$(this)[e?"hide":"show"]()})}function U(){if(!w||E.sidebar.length||E.list.length){switch(g){case"phone":B(),V(!1);break;case"small":B(),V(!0);break;case"normal":E.list.length&&(e=E.list.is(k.last_selected)||!E.sidebar.is(k.last_selected)&&!E.sidebar.is(".layout-sticky"),E.list[e?"removeClass":"addClass"]("hidden")),E.sidebar.length&&(e=!E.list.length||E.sidebar.is(k.last_selected)||E.sidebar.is(".layout-sticky"),E.sidebar[e?"removeClass":"addClass"]("hidden")),E.content.removeClass("hidden"),V(!0),F(),!void(E.list.length&&$(".header > ul.menu",E.list).addClass("popupmenu"));break;case"large":$.each(E,function(e,t){t.removeClass("hidden")}),F(),E.list&&$(".header > ul.menu.popupmenu",E.list).removeClass("popupmenu")}var e;"phone"==g&&$("#logo").data("src-small")?$("#logo").attr("src",$("#logo").data("src-small")):$("#logo").attr("src",$("#logo").data("src-default")),H(),bw.webkit&&bw.ipad&&bw.agent.match(/OS 9/)&&$(".iframe-wrapper").each(function(){var e=$(this).height();e&&$(this).children("iframe").height(e)})}else H()}function H(){$("#layout > div > .header").each(function(){var e,t=0,a=0,n={left:0,right:0};$(this).children(":visible:not(.position-absolute)").each(function(){e||!$(this).is(".header-title")?n[e?"right":"left"]+=this.offsetWidth:e=$(this)}),0+n.right>=n.left?(t=0,a=n.right+0-n.left):(a=0,t=n.left-(0+n.right)),$(e).css({"margin-right":t+"px","margin-left":a+"px","padding-right":"0px"})})}function B(){var e,t=!1;E.content.length&&(e=t=E.content.is(k.last_selected),E.content[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",E.content).addClass("popupmenu")),E.list.length&&(e=!t&&E.list.is(k.last_selected),E.list[e?"removeClass":"addClass"]("hidden"),$(".header > ul.menu",E.list).addClass("popupmenu")),E.sidebar.length&&(e=!t&&(E.sidebar.is(k.last_selected)||!E.list.length),E.sidebar[e?"removeClass":"addClass"]("hidden")),t&&T.back_list.show()}function F(){T.back_list.filter(function(){return 0==$(this).parents("#layout-sidebar").length}).hide(),$("ul.menu.popupmenu").removeClass("popupmenu")}function Y(e){E.list.addClass("hidden"),E.sidebar.removeClass("hidden"),e&&E.sidebar.addClass("layout-sticky"),"small"!=g&&"phone"!=g||E.content.addClass("hidden"),H(),k.last_selected=E.sidebar[0]}function K(e){E.list.length||E.sidebar.length?(E.sidebar.addClass("hidden").removeClass("layout-sticky"),E.list.removeClass("hidden"),"small"!=g&&"phone"!=g||(k.last_selected=E.list[0]||E.sidebar[0],U(),rcmail.show_contentframe(!1),$("[data-list]",E.list).each(function(){var e=$(this).data("list");rcmail[e]&&(rcmail[e].clear_selection?rcmail[e].clear_selection():rcmail[e].select&&rcmail[e].select())})),e&&E.list.children(".scroller").scrollTop(0),k.last_selected=E.list[0]):history.back(),H()}function V(e){e?("phone"==g&&($('<div id="menu-overlay" class="popover-overlay">').on("click",function(){V(!1)}).appendTo("body"),k.menu_initialized||(k.menu_initialized=!0,$("a",E.menu).on("click",function(e){"phone"==g&&V()})),E.menu.addClass("popover")),E.menu.removeClass("hidden")):($("#menu-overlay").remove(),E.menu.addClass("hidden").removeClass("popover"))}function G(e){"loading"==e.type&&$(".iframe-loader:visible").length?rcmail.hide_message(e.object):(J(e.object,e.type,!0),$(e.object).attr("role","alert"))}function J(e,t,a){var n="ui alert",i=!$(e).is(".noicon");a&&i&&!$(e).is(".aligned-buttons")&&$(e).html($("<span>").html($(e).html())),(t={information:"alert-info",notice:"alert-info",confirmation:"alert-success",warning:"alert-warning",error:"alert-danger",loading:"alert-info loading",uploading:"alert-info loading",vcardattachment:"alert-info"}[t=t.split(" ")[0]])&&(n+=" "+t,i&&$("<i>").attr("class","icon").prependTo(e)),$(e).addClass(n)}function Q(i){function e(){$(i).is(".open")&&s.click()}function o(){$(i)[!(a.val()||"mail"==rcmail.task&&$("#s_interval").val()||rcmail.gui_objects.search_filter&&"ALL"!=$(rcmail.gui_objects.search_filter).val()||rcmail.gui_objects.foldersfilter&&"---"!=$(rcmail.gui_objects.foldersfilter).val())?"removeClass":"addClass"]("active"),t[rcmail.gui_objects.search_filter&&"UNSEEN"==$(rcmail.gui_objects.search_filter).val()?"addClass":"removeClass"]("selected")}var t=$(),s=$("a.button.options",i),a=$("input:not([type=hidden])",i),n=a.attr("placeholder");$("form",i);a.is("#mailsearchform")&&(t=$("<a>").attr({class:"button unread",href:"#",role:"button",title:rcmail.gettext("showunread")}).on("click",function(e){$(rcmail.gui_objects.search_filter).val($(e.target).is(".selected")?"ALL":"UNSEEN"),rcmail.command("search")}).insertBefore(s)),s.on("click",function(e){var t=$(this).data("target"),a=$("#"+t),n=$(i).is(".open");a.length&&(n||(v[t]?v[t](a.get(0),this,e):"function"==typeof window[t]&&window[t](a.get(0),this,e)),a.next()[n?"show":"hide"](),a.toggleClass("hidden"),$(".floating-action-buttons").toggleClass("hidden"),$(i).toggleClass("open"),$("button.search",a).off("click.search").on("click.search",function(){s.click(),o()}))}),a.on("input change",o).on("focus blur",function(e){a.attr("placeholder","blur"==e.type?n:"")}),$("a.reset",i).on("click",function(e){a.val("").change().trigger("keyup.treelist",{keyCode:27}),$(i).is(".open")&&s.click(),rcmail.gui_objects.search_filter&&$(rcmail.gui_objects.search_filter).val("ALL"),rcmail.gui_objects.foldersfilter&&($(rcmail.gui_objects.foldersfilter).val("---").change(),rcmail.folder_filter("---")),o()}),rcmail.addEventListener("init",o).addEventListener("responsebeforesearch",o).addEventListener("beforelist",e).addEventListener("afterlist",o).addEventListener("beforesearch",e)}function X(o,a){if(w&&$e())return parent.UI.popup_init(o,a||window);a=a||window;var s,r=$(o).data("popup"),n=$(a.$("#"+r).get(0)),e=n,t=$(o).attr("title");$(o).attr({"aria-haspopup":"true","aria-expanded":"false","aria-owns":r}).popover({content:function(){return a!=window&&(n=e.clone(!0,!0)).attr("id",r+"-clone").appendTo(document.body).find("li > a").attr("onclick","").off("click").on("click",function(e){return $(this).is(".disabled")||($(o).popover("hide"),a.$("#"+$(this).attr("id")).click()),!1}),n.get(0)},trigger:$(o).data("popup-trigger")||"click",placement:$(o).data("popup-pos")||"bottom",animation:!0,boundary:"window",html:!0}).on("show.bs.popover",function(e){var t=n.data("popup-init");r&&x[r]&&(x[r].transitioning=!0),t&&v[t]?v[t](n.get(0),o,e):t&&a[t]&&a[t](n.get(0),o,e),s=$("div.popover:visible").length+1,n.removeClass("hidden").attr("aria-hidden",!1).find('[aria-haspopup="true"]').data("level",s+1).off("click.popup").on("click.popup",function(e){e.stopPropagation()}),$e()||n.css("max-height",Math.min(539,$(window).height()-30))}).on("shown.bs.popover",function(e){var t,a,n=$e(),i=$("#"+$(o).attr("aria-describedby"));s=$(o).data("level")||1,n&&(a=1<s?"back":"close",t=rcmail.gettext(a),a="button icon "+("back"==a?"back":"cancel"),$(".popover-header",i).empty().append($("<a>").attr("class",a).text(t).on("click",function(e){$(o).popover("hide"),1<s&&e.stopPropagation()}).on("mousedown",function(e){e.stopPropagation()}))),$.each(x,function(e,t){$(t.target).data("level")==s&&e!=r&&te(e)}),"key"==$(o).data("event")&&(i.off("keydown.popup").on("keydown.popup","a.active",function(e){var t,a,n="next";switch(e.which){case 27:case 9:return $(o).popover("toggle").focus(),!1;case 38:case 63232:n="previous";case 40:case 63233:for(t=e.target.parentNode;t=t[n+"Sibling"];)if(a=$(t).children(".active")[0]){a.focus();break}return!1}}),i.find("a.active").first().focus()),r&&x[r]&&(x[r].transitioning=!1),n&&!$(".popover-overlay").length&&$("<div>").attr("class","popover-overlay").appendTo("body").click(function(){$(this).remove()}),$(".popover-body",i).addClass("webkit-scroller")}).on("hide.bs.popover",function(){1==s&&$(".popover-overlay").remove(),r&&x[r]&&n.is(":visible")&&(x[r].transitioning=!0)}).on("hidden.bs.popover",function(){/-clone$/.test(n.attr("id"))?n.remove():n.attr("aria-hidden",!0).addClass("hidden").appendTo(n.data("popup-parent")||document.body),$(".popover-body:empty").each(function(){$(this).parent().remove()}),r&&x[r]&&delete x[r]}).on("click",function(){$(this).data("event","mouse")}).on("keydown",function(e){if(e.originalEvent)switch(e.originalEvent.which){case 13:case 32:e.preventDefault(),$(this).data("event","key").popover("toggle");break;case 27:$(this).popover("hide")}}),t&&$(o).attr("title",t),n.attr("aria-hidden","true").data("button",o),n.data("editable")&&n.on("click mousedown",function(e){e.stopPropagation()})}function Z(t){a&&a>(new Date).getTime()-250||$(".popover.show").each(function(){var e=$(".popover-body",this).children().first().data("button");e&&t.target!=e&&!$(e).find(t.target).length&&"string"!=typeof e&&$(e).popover("hide"),e||$(this).remove()})}function ee(e){if(e&&e.name&&(!e.props||!1!==e.props.skinable)){if(w&&$e())return e.win||(e.win=window),parent.UI.menu_toggle(e);var t,a,n,i,o;"messagelistmenu"==e.name?((i=$("#listoptions-menu")).width(),o=i.clone(!0),$('select[name="sort_col"]',o).val(rcmail.env.sort_col||""),$('select[name="sort_ord"]',o).val(rcmail.env.sort_order||"ASC"),$('select[name="mode"]',o).val(rcmail.env.threading?"threads":"list"),$("select",o).each(function(){this.id=this.id+"-clone"}),$("label",o).each(function(){$(this).attr("for",$(this).attr("for")+"-clone")}),o=rcmail.simple_dialog(o,rcmail.gettext("listoptionstitle"),function(e){rcube_event.is_keyboard(e.originalEvent)&&$("#listmenulink").focus();var t=$('select[name="sort_col"]',o).val(),a=$('select[name="sort_ord"]',o).val(),e=$('select[name="mode"]',o).val();return rcmail.set_list_options([],t,a,"threads"==e?1:0),!0},{closeOnEscape:!0,minWidth:400})):"menu-open"==e.event?(i=$("ul",e.obj).first(),n=e.props&&e.props.link?e.props.link:e.originalEvent.target,$(n).is("span")&&(n=$(n).parents("a,li")[0]),e.name.match(/^drag/)&&(a=rcube_event.get_mouse_pos(e.originalEvent),n=$("<a>").css({position:"absolute",left:a.x,top:a.y,height:"1px",width:"1px",visibility:"hidden"}).appendTo(document.body).get(0)),a=$(n).data("popup-pos")||"right","folder-selector"==e.name?i.addClass("listing folderlist"):"addressbook-selector"==e.name||"contactgroup-selector"==e.name?i.addClass("listing contactlist"):i.hasClass("menu")&&i.addClass("listing"),"pagejump-selector"==e.name&&(i.addClass("simplelist"),e.obj.addClass("simplelist"),a="top"),x[e.name]&&te(e.name,e.originalEvent),(t=function(){if(x[e.name]&&x[e.name].transitioning)return setTimeout(t,50);$(n).data("popup")||($(n).data({event:rcube_event.is_keyboard(e.originalEvent)?"key":"mouse",popup:e.name,"popup-pos":a,"popup-trigger":"manual"}),X(n,e.win)),x[e.name]={target:n},setTimeout(function(){$(n).popover("show")},1)})()):te(e.name,e.originalEvent),e.originalEvent.stopPropagation()}}function te(e,t){var a=function(e){var t;x[e]?t=x[e].target:(t=$("#"+e).data("button"))||(e.match(/(?!-)menu$/)&&(e=e.substr(0,e.length-4)),t=$("#"+e+"-menu").data("button"));return t}(e);e.match(/^drag/)?$(a).popover("dispose").remove():($(a).popover("hide"),"forwardmenu"==e&&Z(t))}function ae(e,t){var a,n,i=rcmail.env.task,o=rcmail.env.search_mods,s=rcmail.env.mailbox,r=$("#s_scope",e).val(),l=$("#s_interval",e).val();"all"==r&&(s="*"),o=o||{},"mail"==i?(o[s]||(o[s]=rcube_clone_object(o["*"])),n=o[s],a="text",rcmail.env.search_scope=r,rcmail.env.search_interval=l):(n=o,a="*"),t&&(t.checked?n[t.value]=1:delete n[t.value],t.value==a&&$('input[name="s_mods[]"]',e).map(function(){this!=t&&(this.checked=!0,t.checked?(this.disabled=!0,delete n[this.value]):(this.disabled=!1,n[this.value]=1))}),rcmail.set_searchmods(n))}function ne(e,t){var a=$("#composestatusbar"),n=a.find("a.button.icon."+e);t?n.length||$("<a>").attr("class","button icon "+e).on("click",function(){Y()}).appendTo(a):n.remove()}function ie(e,t,a){var n=$(t).parent().attr("id").replace(/^attach/,"");return $.each(["open","download","rename"],function(){var t=this;$("#attachmenu"+t,e).off("click").attr("onclick","").click(function(e){return rcmail.command(t+"-attachment",n,this,e.originalEvent)})}),rcmail.command("menu-open",{menu:"attachmentmenu",id:n},e,a)}function oe(e){var t,a,n;(e=$(e)).is(".no-menu")||e.children(".dropdown").length||(t=rcmail.gettext("options"),a=e.find("a.filename"),n=$("<a>").attr({href:"#",tabindex:a.attr("tabindex")||0,title:t,class:"button icon dropdown skip-content"}).on("click",function(e){return ie($("#attachmentmenu"),n,e)}).append($("<span>").attr("class","inner").text(t)),a.length?n.insertAfter(a):n.appendTo(e))}function se(e,n,t,a){var i=$(n).attr("href").replace(/^mailto:/,"");return i.indexOf("@")<0||(e.find("a").off("click").removeClass("active"),rcmail.env.has_writeable_addressbook&&$(".addressbook",e).addClass("active").on("click",function(e){var t=i,a=$(n).filter(".rcmContactAddress").text(),t=t.split("?")[0].split(",")[0].replace(/(^<|>$)/g,"");return a&&(a=a.replace("<"+t+">",""),t='"'+$.trim(a)+'" <'+t+">"),rcmail.command("add-contact",t,this,e.originalEvent)}),$(".compose",e).addClass("active").on("click",function(e){return a?(n.onclick=a,$(n).trigger("click",[!0]),n.onclick=null):rcmail.command("compose",i,this,e.originalEvent),!1}),rcmail.command("menu-open",{menu:"mailto-menu",link:n},n,t.originalEvent))}function re(t){var e=$("#quotadisplay"),a=e.find(".bar"),n=t.total?t.percent:0;0<n&&n<10&&(n=10),(a=!a.length?$('<span class="bar"><span class="value"></span></span>').appendTo(e):a).find(".value").css("width",n+"%")[90<=n?"addClass":"removeClass"]("warning"),e.attr({"data-original-title":"",title:e.find(".count").attr("title")}),t.table?e.css("cursor","pointer").data("popup-pos","top").off("click").on("click",function(e){rcmail.simple_dialog(t.table,"quota",null,{cancel_button:"close"})}):e.tooltip("dispose").tooltip({trigger:$e()?"click":"hover"})}function le(a){a=$.trim(a.replace(/[,;\s]*[\r\n]+/g,","));var n=[],e='(\\S+|("[^"]+"))@\\S+',i=new RegExp("(<"+e+">)"),o=new RegExp("("+e+")"),e=a.match(/(?=\S)[^",;]*(?:"[^\\"]*(?:\\[,;\S][^\\"]*)*"[^",;]*)*/g);return $.each(e||[],function(){var e,t;this.length&&(i.test(this)||o.test(this))&&(e=RegExp.$1,t=$.trim(this.replace(e,"")),n.push({name:t,email:e.replace(/(^<|>$)/g,""),text:this}),a=a.replace(this,""))}),a=a.replace(/[,;]+/,",").replace(/^[,;\s]+/,""),{recipients:n,text:a}}function ce(e){var t;(e=$(e)).length&&(t=$('<div class="iframe-loader">').append($('<div class="spinner spinner-border" role="status">').append($('<span class="sr-only">').text(rcmail.gettext("loading")))),e.on("load error loaded",function(){setTimeout(function(){t.remove()},500)}).parent().append(t),_&&e.parent().addClass("ios-scroll"))}function de(e){var t,a;(e=$(e)).is(".custom-control-input")||((a=e.attr("id"))||(a="icochk"+ ++k.checkboxes,e.attr("id",a)),e.parent().is("label")?(t=e.parent(),e=e.detach(),t.before(e)):t=$("<label>"),t.attr({for:a,class:"custom-control-label",title:e.attr("title")||""}).on("click",function(e){e.stopPropagation()}),e.addClass("form-check-input custom-control-input").wrap('<div class="custom-control custom-switch">').parent().append(t))}function pe(e){var t=$(e.row).find("input[id^=icochk]");t.length&&(e="icochk"+ ++k.checkboxes,t.attr("id",e).next("label").attr("for",e))}function ue(p){var u,t,m;bw.iphone||bw.ipad||(p=$(p)).is(".pretty-select")||(u="select"+p.attr("id")+p.attr("name"),t=function(){if(p[0].ownerDocument.defaultView.$(".select-menu .listing").data("ident")==u)return!0},m=function(){var e=t();return p.popover("dispose").focus(),!e},p.addClass("pretty-select custom-select form-control").on("mousedown keydown",function(e){if(!(p=$(e.target)).prop("disabled"))return 9==e.which?(m(),!0):27==e.which||"mousedown"==e.type&&t()?m():(p.focus(),p.prop("disabled",!0),setTimeout(function(){p.prop("disabled",!1)},0),e.stopPropagation(),"mousedown"==e.type||13==e.which||32==e.which||40==e.which||63233==e.which?(function(a){var s,r=-1,n=[],l=[],e=p.closest(".ui-dialog")[0],t=(document.documentElement.clientHeight||$(document.body).height())-75,i=$(document.body).width()-20,o=Math.min(p.outerWidth(),i),c=p.val();$e()||(t*=.5),Z(a),$("option",p).each(function(){var e=$(this).text(),t=$('<a href="#">').data("value",this.value).addClass(this.disabled?"disabled":"active"+(this.value==c?" selected":""));e.length?(t.text(e),l.push(this.disabled?"":e.charAt(0).toLowerCase())):(t.html("&nbsp;"),l.push("")),n.push($("<li>").append(t))});var d=$('<ul class="listing selectable iconized">').attr("data-ident",u).data("button",p[0]).append(n).on("click","a.active",function(){var e=$(this).data("value"),t=m();return p.val(e).change(),t}).on("keydown","a.active",function(e){var t,a,n,i,o="next";switch(e.which){case 27:case 9:return m();case 13:case 32:return $(this).click(),!1;case 38:case 63232:o="previous";case 40:case 63233:for(t=e.target.parentNode;t=t[o+"Sibling"];)if(i=$(t).children(".active")[0]){i.focus();break}return!1;default:(a=e.originalEvent.key)&&1==a.length&&(a=a.toLowerCase(),s!=a&&(r=-1),(-1<(n=l.indexOf(a,r+1))||-1<(n=l.indexOf(a)))&&d.find("a").eq(n).focus(),s=a,r=n)}});p.popover("dispose").popover({container:e||document.body,content:d[0],placement:"bottom",trigger:"manual",boundary:"viewport",html:!0,offset:"0,2",sanitize:!1,template:'<div class="popover select-menu" style="min-width: '+o+"px; max-width: "+i+'px"><div class="popover-header"></div><div class="popover-body" style="max-height: '+t+'px"></div></div>'}).on("shown.bs.popover",function(){p.focus(),d.parent().prev().empty().append($('<a class="button icon cancel">').text(rcmail.gettext("close")).on("click",function(e){return e.stopPropagation(),m()}));var e,t=d.find("a.selected").first();t.focus().length?(e=d.parent(),r=d.find("a").index(t[0]),s=l[r],5<r&&e.scrollTop(e.scrollTop()+e.height()/2)):rcube_event.is_keyboard(a)&&d.find("a.active").first().focus(),d.on("mousedown",function(e){e.stopPropagation()})}).popover("show")}(e),a=(new Date).getTime(),!1):void 0)}))}function me(i,e,t,a,o,n){var s=$('<div class="input-group"><input type="text" class="form-control"><span class="input-group-append"><a class="icon reset input-group-text" href="#"></a></span></div>'),t={value:e,name:t+"[]"};return o&&(t.size=o),$("input",s).attr(t).keydown(function(e){var t=$(this);if(13==e.which){var a=t.attr("name").replace(/\[\]$/,""),n=(new Date).getTime(),n=me(i,"",a,0,o,t.parent());$("input",n).focus()}else if((8==e.which||46==e.which)&&""==t.val()){t=t.parent();if(1<i.children().length)return(t.prev().length?t.prev():t.next()).children("input").focus(),t.remove(),!1}}),$("a.reset",s).click(function(){var e=$(this.parentNode.parentNode);1<i.children().length?($("input",e.next().length?e.next():e.prev()).focus(),e.remove()):$("input",e).val("").focus()}),$(s).find("input,a").on("focus",function(){i.addClass("focused")}).on("blur",function(){i.removeClass("focused")}),n?n.after(s):s.appendTo(i),s}function he(o){function s(e){o.css({width:Math.max(100,e),flex:"none"})}var e=o.find(".scroller .listing").first().attr("id"),r=rcmail.env.task+"."+(e||rcmail.env.action+"."+o.attr("id")),e=function(e){c=c||rcmail.local_storage_get_item("prefs.elastic",{});{var t;null!=c[e]||null!=(t=rcmail.get_cookie(e))&&(c[e]=t,rcmail.local_storage_set_item("prefs.elastic",c)&&rcmail.set_cookie(e,t,new Date))}return c[e]}(r),l=o.is(".sidebar-right");o[l?"prev":"next"]().length&&($('<div class="column-resizer">').appendTo(o).on("mousedown",function(e){var a,n=$(this),i=o.position().left;n.width(1e4).css(l?"left":"right",-5e3),document.body.style.userSelect="none",$(document).on("mousemove.resizer",function(t){clearTimeout(a),a=setTimeout(function(){l&&(i=o.position().left);var e=rcube_event.get_mouse_pos(t).x,e=l?o.width()+(i-e):e-i;s(e)},5)}).on("mouseup.resizer",function(){var e,t,a;$(document).off(".resizer"),$("iframe").off(".resizer"),document.body.style.userSelect="auto",n.width(6).css(l?"left":"right",-3),e=r,t=o.width(),c[e]=t,rcmail.local_storage_set_item("prefs.elastic",c)||((a=new Date).setYear(a.getFullYear()+1),rcmail.set_cookie(e,t,a))})}),e&&s(e))}function fe(e){if(!$e()||!0===arguments[3])return k.open_window.apply(rcmail,arguments);e=rcmail.add_url(e,"_framed",1),e=rcmail.add_url(e,"_extwin",1);var t,a="",n={cancel_button:"close",width:768,height:768},i=$("<iframe>").attr({id:"windowframe",src:e});return/_action=([a-z_]+)/.test(e)&&(t=rcmail.labels[RegExp.$1])&&(a=t),/_frame=1/.test(e)&&(n.dialogClass="no-titlebar"),rcmail.simple_dialog(i,a,null,n),!0}function ve(){if(w){var e=$(parent.document.documentElement);return{mode:e[0].className.match(/layout-([a-z]+)/)?RegExp.$1:g,touch:e.is(".touch")}}return{mode:g,touch:b}}function $e(){var e=ve();return"phone"==e.mode||"small"==e.mode}this.register_content_buttons=function(e){{var t;k.frame_nav&&e&&e.length&&(t=k.frame_nav.children(".buttons"),y=[],$.each(e,function(){this.data("target")&&y.push(this.data("target"))}),t.html("").append(e))}},this.menu_hide=te,this.menu_toggle=ee,this.menu_destroy=function(e){$("[aria-owns="+e+"]").popover("dispose").data("popup",null)},this.popup_init=X,this.about_dialog=function(e){var t,a,n=!1,i=$("<iframe>").attr({id:"aboutframe",src:rcmail.url("settings/about",{_framed:1})}),o=$("#supportlink");o.length&&(t=o.attr("href"))&&(n=o.text(),a=function(e){t.indexOf("mailto:")<0?window.open(t):location.href=t});rcmail.simple_dialog(i,$(e).text(),a,{button:n,button_class:"help",cancel_button:"close",height:400})},this.headers_dialog=function(){var e={_uid:rcmail.env.uid,_mbox:rcmail.env.mailbox,_framed:1},e=$("<iframe>").attr({id:"headersframe",src:rcmail.url("headers",e)});rcmail.simple_dialog(e,rcmail.gettext("arialabelmessageheaders"),null,{cancel_button:"close",height:400})},this.import_dialog=function(){if(!rcmail.commands["import-messages"])return;var t=$("#uploadform").clone(!0);rcmail.simple_dialog(t,rcmail.gettext("importmessages"),function(e){return rcmail.command("import-messages",$(t.find("form")[0]))},{button:"import",closeOnEscape:!0,minWidth:400})},this.headers_show=function(e){e=$(e).parent().prev();e[e.is(".hidden")?"removeClass":"addClass"]("hidden")},this.spellmenu=function(e){var t,a,n=[],i=rcmail.spellcheck_lang(),o=$("ul",e);if(!o.length){for(t in o=$('<ul class="selectable listing iconized" role="menu">'),rcmail.env.spell_langs)a=$('<li role="menuitem">'),$('<a href="#'+t+'" tabindex="0"></a>').text(rcmail.env.spell_langs[t]).addClass("active").data("lang",t).on("click keypress",function(e){if("keypress"!=e.type||13==rcube_event.get_keycode(e))return rcmail.spellcheck_lang_set($(this).data("lang")),rcmail.hide_menu("spell-menu",e),!1}).appendTo(a),n.push(a);o.append(n).appendTo(e)}$("li",o).each(function(){var e=$("a",this);e.data("lang")==i?e.addClass("selected").attr("aria-selected","true"):e.hasClass("selected")&&e.removeClass("selected").removeAttr("aria-selected")})},this.searchmenu=function(e){var t,a,n=$('input[name="s_mods[]"]',e),i=$("#s_scope",e),o=rcmail.env.mailbox,s=rcmail.env.search_mods,r=rcmail.env.search_scope||"base";$(e).data("initialized")||($(e).data("initialized",!0),n.length&&(n.on("change",function(){ae(e,this)}),rcmail.addEventListener("beforesearch",function(){ae(e)})));if(rcmail.env.search_mods)if("mail"==rcmail.env.task?(s=s[o="all"==r?"*":o]||s["*"],a="text",i.val(r)):a="*",s[a])n.map(function(){this.checked=!0,this.disabled=this.value!=a});else for(t in n.prop("disabled",!1).prop("checked",!1),s)n.filter('[value="'+t+'"]').prop("checked",!0)},this.headersmenu=function(e,t,a){$("li > a",e).each(function(){var e=$(this),t="#compose_"+e.data("target");e[$(t).is(":visible")?"removeClass":"addClass"]("active").off().on("click",function(){$(t).removeClass("hidden").find(".recipient-input input").focus(),e.removeClass("active"),rcmail.set_menu_buttons()})})},this.header_reset=function(e){$("#"+e).val("").change().closest(".form-group").nextAll(":not(.hidden)").first().find("input").focus(),$("a[data-target="+e.replace(/^_/,"")+"]").addClass("active"),rcmail.set_menu_buttons()},this.compose_status=ne,this.attachmentmenu=ie,this.mailtomenu=se,this.recipient_selector=function(e,t){t=t||{};function a(){i.is(":visible")&&rcmail.env.recipient_dialog.dialog("close")}var n=rcmail.gettext(t.title||"insertcontact"),i=$("#recipient-dialog"),o=i.parent();rcmail.env.recipient_selector_initialized||(rcmail.addEventListener("add-recipient",a),rcmail.env.recipient_selector_initialized=!0);e&&(rcmail.env.focused_field="#_"+e);rcmail.contact_list.clear_selection(),rcmail.contact_list.multiselect=!("multiselect"in t)||t.multiselect,rcmail.env.recipient_dialog=rcmail.simple_dialog(i,n,function(){if(t.action)return t.action(),void a();rcmail.command("add-recipient")},{button:rcmail.gettext(t.button||"insert"),button_class:t.button_class||"insert recipient",height:600,classes:{"ui-dialog-content":"p-0"},open:function(){$("#directorylist a").first().focus()},close:function(){i.appendTo(o),$(this).remove(),$(t.focus||rcmail.env.focused_field).focus()}})},this.show_list=K,this.show_sidebar=Y,this.smart_field_init=function(a){var e=a.id+"_list",n=$('<div class="multi-input"><div class="content"></div><div class="invalid-feedback"></div></div>'),t=a.value?a.value.split("\n"):[""];if($("#"+e).length)return;$.each(t,function(e,t){me($(".content",n),t,a.name,0,$(a).data("size"))}),n.attr("id",e),(a=$(a)).attr("disabled")?n.hide():a.prop("disabled",!0);a.data("hidden")&&n.hide();a.after(n),a.hasClass("is-invalid")&&(n.addClass("is-invalid"),$(".invalid-feedback",n).text(a.data("error-msg")))},this.smart_field_reset=function(a,e){var t=a.id+"_list",e=e.length?e:[""],n=$("#"+t).children(".content");n.empty(),$.each(e,function(e,t){me(n,t,a.name,0,$(a).data("size"))})},this.form_errors=function(e){$.each(e,function(){var e=$("#"+this[0]).addClass("is-invalid");if("list"==e.data("type"))return e.data("error-msg",this[2]),void $("#"+this[0]+"_list > .invalid-feedback").text(this[2]);e.after($('<span class="invalid-feedback">').text(this[2]))})},this.switch_nav_list=function(e){var t,a,n=$("a",e),i=$(e).next();i.height()?(i.animate({height:"0"},250),n.addClass("expand").removeClass("collapse"),$(e).removeClass("expanded")):(t=$("tr,li",i).filter(function(){return"none"!=this.style.display}),a=$(t[0]).height()||50,i.animate({height:Math.min(5,t.length)*a+1+"px"},250),n.addClass("collapse").removeClass("expand"),$(e).addClass("expanded"))},this.searchbar_init=Q,this.pretty_checkbox=de,this.pretty_select=ue,this.datepicker_init=function(e){window.MutationObserver&&$(e).not("[data-observed]").each(function(){var n,i=!0,o=w?parent:window;$(this).attr("data-observed","1"),w&&($(this).detach().appendTo(parent.document.body),$('<div id="ui-datepicker-div" class="hidden">').appendTo(document.body)),new MutationObserver(function(e){$.each(e,function(e,t){var a;"attributes"==t.type?(a="true"==$(t.target).attr("aria-hidden"))!=i&&(a?n&&n.remove():n=$("<div>").attr("class","ui-widget-overlay datepicker").appendTo(o.document.body).click(function(e){$(this).remove(),w&&$.datepicker._hideDatepicker()}),i=a):t.addedNodes.length&&(o.UI.bootstrap_style(t.target),w&&(o.$("select.ui-datepicker-month",t.target).on("change",function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"M")}),o.$("select.ui-datepicker-year",t.target).on("change",function(){$.datepicker._selectMonthYear($.datepicker._lastInput,this,"Y")})))})}).observe(this,{childList:!0,subtree:!1,attributes:!0,attributeFilter:["aria-hidden"]})})},this.bootstrap_style=A,W(),k.last_selected=$("#layout > div.selected")[0],!k.last_selected&&E.content.length&&$.each(["sidebar","list","content"],function(){if(E[this].length)return k.last_selected=E[this][0],E[this].addClass("selected"),!1}),$(window).on("resize",function(){clearTimeout(k.resize_timeout),k.resize_timeout=setTimeout(function(){q()},25)}),k.open_window=rcmail.open_window,rcmail.open_window=fe,rcmail.addEventListener("message",G).addEventListener("menu-open",ee).addEventListener("menu-close",ee).addEventListener("editor-init",N).addEventListener("autocomplete_create",R).addEventListener("googiespell_create",R).addEventListener("setquota",re).addEventListener("enable-command",P).addEventListener("clonerow",pe).addEventListener("init",I),window.MutationObserver&&window.tinymce&&(e=function(e){$.each(e,function(){$.each(this.addedNodes,function(){var e,t,a,n;e=this,$(e).is(".mce-window")?(t=$(e).find(".mce-window-body"),n=$(e).find(".mce-foot > .mce-container-body"),t.length&&A(t[0]),t.find("button").filter(function(){return 0<$(this).parent(".mce-btn").length}).removeClass("btn btn-secondary"),5===n.children(".mce-widget").length&&n.addClass("mce-search-foot"),$(e).find(".mce-charmap").parent().parent().addClass("mce-charmap-dialog"),$(e).find(".mce-combobox").each(function(){$(this).children(".mce-btn").length||$(this).addClass("mce-combobox-fake")}),$(e).find(".mce-form > .mce-container-body").each(function(){4<$(this).children(".mce-formitem").length&&$(this).addClass("mce-form-split")}),$(e).find(".mce-form").next(":not(.mce-formitem)").addClass("mce-form"),$e()||(a=0,n=t.height(),$(e).find(".mce-form").each(function(){a=Math.max(a,$(this).height())}),n<a&&(a+=(t.find(".mce-tabs").height()||0)+25,t.height(a),$(e).height($(e).height()+(a-n)),$(e).css("top",($(window).height()-$(e).height())/2+"px")))):$(e).is(".mce-menu")&&($(e).prepend($('<h3 class="popover-header">').append($('<a class="button icon "cancel">').text(rcmail.gettext("close")).on("click",function(){$(document.body).click()}))),window.MutationObserver&&new MutationObserver(function(){"phone"==g&&($(".mce-menu:visible").length?$("div.mce-overlay").length||$("<div>").attr("class","popover-overlay mce-overlay").appendTo("body").click(function(){$(this).remove()}):$("div.mce-overlay").click())}).observe(e,{attributes:!0}))})})},new MutationObserver(e).observe(document.body,{childList:!0})),(E.list.length||E.content.length)&&$e()&&(n=[],$("[data-fab]").each(function(){var e=$(this),t=e.data("fab-task")||"*",a=e.data("fab-action")||"*";"*"!=t&&t!=rcmail.env.task||"*"!=a&&a!=rcmail.env.action&&("none"!=a||rcmail.env.action)||n.push(S(e,!1,!1,!0))}),n.length&&$('<div class="floating-action-buttons">').append(n).appendTo(E.list.length?E.list:E.content)),E.sidebar.length&&he(E.sidebar),E.list.length&&he(E.list),A(),k.got_smart_toolbar||(k.got_smart_toolbar=!0,i=[],o=[],s=ve(),E.content.find(".header > .menu").each(function(){var e=$(this);e.children().each(function(){L(this,i)}),e.remove()}),E.list.find(".header > .menu").each(function(){var e=$(this);t=e.next(),e.children().each(function(){"large"!=s.mode&&$(this).data("popup-pos","right"),L(this,i,!0),L(this,o)}),e.remove()}),$('ul[data-menu="toolbar-small"] > li > a').each(function(){var e=$(this).clone();e.attr("id",this.id+"_clone"),i.push($('<li role="menuitem">').addClass("hidden-big").append(e))}),o.length&&(l=E.list.children(".header"),d={class:"menu toolbar popupmenu listing iconized",id:"toolbar-list-menu"},p=$('<a class="button icon toolbar-list-button" href="#list-menu">').attr({"data-popup":"toolbar-list-menu"}),r=$("<ul>").attr(d).data("popup-parent",l).append(o),t.length?r.insertBefore(t):l.append(r),l.append(p)),i.length&&(l=E.content.children(".header"),d={class:"menu toolbar popupmenu listing iconized",id:"toolbar-menu"},p=$('<a class="button icon toolbar-menu-button" href="#menu">').attr({"data-popup":"toolbar-menu"}),l.append($("<ul>").attr(d).data("popup-parent",l).append(i)).append(p),E.list.find("a.toolbar-menu-button").click(function(e){e.stopPropagation(),p.click()}))),E.list.length&&(u=k.last_selected,E.content.find("iframe").on("load",function(e){var t="",a=!0;$(this).parent(".iframe-wrapper").scrollTop(0);try{a=!(t=e.target.contentWindow.location.href).endsWith(rcmail.env.blankpage),$(e.target.contentWindow).on("unload",j)}catch(e){}z(e,t,a)}),rcmail.addEventListener("afterlist",O).addEventListener("afterlistgroup",O).addEventListener("afterlistsearch",O).addEventListener("show-list",function(e){e.force=!0,M(e)}).addEventListener("show-content",function(e){e.obj&&!$(e.obj).is("iframe")&&($(e.scrollElement||e.obj).scrollTop(0),$e()&&ce(e.obj)),z(e.event||new Event,"_action="+(e.mode||"edit"),!0,e.title)})),$("[data-popup]").each(function(){X(this)}),$(document).on("click",Z),rcube_webmail.set_iframe_events({mousedown:Z,touchstart:Z}),f=[],$.ui&&$.widget("ui.dialog",$.ui.dialog,{open:function(){var e,t,a,n,i,o;return $(this.element).is(".iframe")&&(this.options.width=Math.max(576,this.options.width)),this._super(),e=this,t=$(e.uiDialog),a=t.width(),n=t.height(),i=$(window).width(),o=$(window).height(),i<=480?t.css({width:"100%",height:"100%"}):(o<n&&t.css("height","100%"),i<a&&t.css("width","100%")),$(document).click(),ce($("div.popup > iframe",t)),A(e.uiDialog),this},close:function(){return this._super(),$(".select-menu:visible").remove(),this}}),T.menu.on("click",function(){return V(!0),!1}),T.back_sidebar.on("click",function(){return Y(),!1}),T.back_list.on("click",function(){return K(),!1}),T.back_content.on("click",function(){return E.list.addClass("hidden"),E.sidebar.addClass("hidden"),E.content.removeClass("hidden"),E.sidebar.removeClass("layout-sticky"),H(),k.last_selected=E.content[0],!1}),$(".searchbar").each(function(){Q(this)}),!w||rcmail.env.extwin||parent.$(".ui-dialog:visible").length?w||(m=(m=E.content.find(".boxtitle").first().detach().text())||$("h1.voice").first().text())&&E.content.find(".header > .header-title").text(m):(m=$("h1.voice").first().text())&&parent.$("#layout-content > .header > .header-title:not(.constant)").text(m),w||!E.content.length||E.content.is(".no-navbar")||E.content.children(".frame-content").length||(k.frame_nav=$('<div class="footer menu toolbar content-frame-navigation hide-nav-buttons">').append($('<a class="button prev">').append($('<span class="inner"></span>').text(rcmail.gettext("previous")))).append($('<span class="buttons">')).append($('<a class="button next">').append($('<span class="inner"></span>').text(rcmail.gettext("next")))).appendTo(E.content)),$("a[data-content-button]").each(function(){f.push(S($(this)))}),$(".formbuttons").filter(function(){return!$(this).parent(".searchoptions").length}).children().each(function(){var e=$(this);(w||e.parents("#layout-content").length)&&(e.is(".cancel")?e.addClass("hidden"):f.push(S(e)))}),(w?parent.UI:v).register_content_buttons(f),(h=rcmail.gui_objects.messageform)&&(h=$('form[name="'+h+'"]'),$("#_cc, #_bcc, #_replyto, #_followupto",$(".compose-headers")).each(function(){$(this).on("change",function(){$("#compose"+$(this).attr("id"))[this.value?"removeClass":"addClass"]("hidden")})}),$("#compose-options").find("textarea,input,select").each(function(){var e=$("<input>").attr({type:"hidden",name:$(this).attr("name")}).appendTo(h);$(this).attr("tabindex",2).on("change",function(){e.val("checkbox"!=this.type||this.checked?$(this).val():"")}).change()})),$("[data-recipient-input]").each(function(){function r(){$(e).val(s.text()+l.val())}function o(e){return e=le(e=(e||l.val()).replace(/[,;\s]+$/,"")),$.each(e.recipients,function(){c(this.name,this.email)}),l.val(e.text),r(),0<e.recipients.length}var e,s,l,t,c;e=this,t="",c=function(e,t,a){var n=$('<li class="recipient">'),i=$('<span class="name">').html(function(e){var t,a,n="",i=e.length;'"'!=e.charAt(0)&&-1<e.indexOf('"')&&(e='"'+e.replace("\\","\\\\").replace('"','\\"')+'"');for(t=0;t<i;t++)switch(a=e.charAt(t)){case'"':if(0<t&&t<i-1){n+='"';break}n+='<span class="quotes">'+a+"</span>";break;case"\\":n+='<span class="quotes">'+a+"</span>","\\"==e.charAt(t+1)&&(n+=a,t++);break;case"<":n+="&lt;";break;case">":n+="&gt;";break;default:n+=a}return n}(e||t)).on("dblclick",function(e){var t,a,n,i;e=e,t=c,a=$(e.target).parents(".recipient"),n=a.text().replace(/,+$/,""),i=$("<input>").attr({type:"text",size:50}).val(n),e=$("<label>").text(rcmail.gettext("recipient")).append(i),rcmail.simple_dialog(e,"recipientedit",function(){var e=i.val();if(e){if(e!=n){if(1!=(e=le(e)).recipients.length)return!1;t(e.recipients[0].name,e.recipients[0].email,a)}return!0}})}),o=$('<span class="email">'),s=$("<a>").attr({class:"button icon remove"}).click(function(){return n.remove(),r(),l.focus(),!1});e&&(t=" <"+t+">"),o.text((e?t:"")+","),n.attr("title",e?e+t:null).append([i,o,s]),a?a.replaceWith(n):n.insertBefore(l.parent()),r()},l=$("<input>").attr({type:"text",tabindex:$(e).attr("tabindex")}).on("paste change",function(e,t){var a,n,i=this.value;"paste"==e.type?(n=(e.originalEvent.clipboardData||window.clipboardData).getData("text")||"",i=i.substring(0,this.selectionStart)+n+i.substring(this.selectionEnd),e.preventDefault()):t&&(a=s.find("li.recipient").last()).length&&-1<this.value.indexOf(a.text().replace(/[ ,]+$/,""))&&a.remove(),o(i)}).on("keydown",function(e){return 8!=e.keyCode||l.val().length?!((","==e.key||";"==e.key||"Enter"==e.key&&!rcmail.ksearch_visible())&&o())&&void 0:(s.children("li.recipient").last().remove(),r(),!1)}).on("blur",function(){s.removeClass("focus")}).on("focus mousedown",function(){s.addClass("focus")}),s=$("<ul>").addClass("form-control recipient-input ac-input rounded-left").append($('<li class="input">').append(l)).on("mouseup",function(){t=window.getSelection().toString()}).on("click",function(){t.length||l.focus()}),$(e).css({position:"absolute",opacity:0,left:"-5000px",width:"10px"}).attr("tabindex",-1).after(s).on("focus",function(e){l.focus(),e.preventDefault()}).on("change",function(){$("li.recipient",s).remove(),l.val(this.value).change()}).change(),rcmail.init_address_input_events(l)}),$(".image-upload").each(function(){function e(){var e=-1!=(n.currentSrc||n.src).indexOf(rcmail.env.photo_placeholder);$(t)[e?"removeClass":"addClass"]("changed")}var t,a,n;t=this,a=$("<a>").attr({class:"icon button delete",href:"#"}).click(function(e){return rcmail.command("delete-photo","",this,e),!1}),n=$(t).find("img")[0],$(t).append(a).click(function(){rcmail.upload_input("upload-form")}),e(),$(n).on("load",e)}),$("textarea[data-html-editor]").each(function(){var e,t,a,n,i,o,s;e=this,a=!1,n=$(e),i=n.parent(),o=$('<a class="mce-i-html" href="#" tabindex="-1"></a>').attr("title",rcmail.gettext("htmltoggle")).on("click",function(e){rcmail.command("toggle-editor",{id:n.attr("id"),html:!0},"",e.originalEvent)&&i.addClass("ishtml")}).on("keydown",function(e){if(9==e.which)return n.focus(),!1}),s=$('<div class="editor-toolbar">').append(o),i.is("td")?(t=$('input[type="checkbox"]',i.parent().next()),a=!0):t=n.next("select.hidden"),function(i){var o,s,r=function(){if(!i.scrollHeight)return setTimeout(r,250);var e,t,a,n;o||(o=parseInt($(i).css("padding-top"))+parseInt($(i).css("padding-bottom"))+2,s=$(i).height()),i.scrollHeight-o<=s||(t=0,$(i).parents().each(function(){if(0<this.scrollTop)return t=(e=this).scrollTop,!1}),a=$(i).outerHeight(),$(i).outerHeight(0),n=Math.max(s,i.scrollHeight),$(i).outerHeight(a),n!==a&&$(i).height(n),t&&(e.scrollTop=t))};$(i).on("input",r).trigger("input")}(e),1==t.length&&(i.addClass("html-editor"),n.after(s).data("control",t).on("keydown",function(e){e.altKey&&121==e.which&&o.focus()}),a&&(t.parents("tr").first().hide(),i.prev().hide(),i.addClass("col-sm-12")))}),$("#dragmessage-menu,#dragcontact-menu").each(function(){rcmail.gui_object("dragmenu",this.id)}),$("#taskmenu > a").each(function(){var e,t,a;/button-([a-z]+)/.test(this.className)&&(t=RegExp.$1,(a=D(this.id))&&(e=a.data)&&(e.sel&&(e.sel=e.sel.replace("button-selected","selected")+" "+t),e.act&&(e.act+=" "+t),rcmail.buttons[a.command][a.index]=e,rcmail.init_button(a.command,e)),$(this).addClass(t),$(".button-inner",this).addClass("inner")),$(this).on("mouseover",function(){rcube_webmail.long_subject_title(this,0,$("span.inner",this))})}),$(".listbutton").each(function(){var e=D(this.id);$(this).addClass("button").removeClass("listbutton"),e.data.sel&&(e.data.sel=e.data.sel.replace("listbutton","button")),e.data.act&&(e.data.act=e.data.act.replace("listbutton","button")),rcmail.buttons[e.command][e.index]=e.data,rcmail.init_button(e.command,e.data)}),$("[data-hidden]").each(function(){for(var e,t=$(this).data("hidden"),a=$(this).parent("li"),n=/(large|big|small|phone|lbs)/g;e=n.exec(t);)$(a.length?a:this).addClass("hidden-"+e[1])}),$("[data-list]").each(function(){$("input[type=checkbox]",this).each(function(){de(this)})}),w&&$(".formcontent").each(function(){$(this).next(".formbuttons").length&&$(this).parent().addClass("formcontainer")}),$("#attachment-list + a.zipdownload").appendTo(".header-links"),(_=$("html").is(".ipad,.iphone"))&&$(".iframe-wrapper, .scroller").addClass("ios-scroll"),$("html").filter(".ipad,.iphone,.webkit.mobile,.webkit.tablet").addClass("webkit-scroller").length&&$(E.menu).addClass("webkit-scroller"),$(".treelist").each(function(){function e(){$(t)[0<$(".treetoggle",t).length?"removeClass":"addClass"]("notree")}var t=this;window.MutationObserver&&new MutationObserver(e).observe(t,{childList:!0,subtree:!0}),e(),$("li.mailbox > a").on("mouseover",function(){rcube_webmail.long_subject_title_ex(this)})}),$("#logo").data("src-default")||$("#logo").data("src-default",$("#logo").attr("src")),q()}var rcmail,rcube_webmail,bw;window.rcmail?(rcmail.show_menu=function(e,t,a){var n="object"==typeof e?e.menu:e,i=$("#"+n);return"string"==typeof e&&(e={menu:n}),rcmail.triggerEvent(!1===t?"menu-close":"menu-open",{name:n,obj:i,props:e,originalEvent:a})},rcmail.hide_menu=function(e,t){return rcmail.triggerEvent("menu-close",{name:e,props:{menu:e},originalEvent:t})}):(rcmail=parent.rcmail,rcube_webmail=parent.rcube_webmail,bw={});var __newInst,UI=new rcube_elastic_ui;$&&$.datepicker&&(__newInst=$.datepicker._newInst,$.extend($.datepicker,{_newInst:function(e,t){t=__newInst.call(this,e,t);return t.inline||UI.datepicker_init(t.dpDiv),t}}));
//# sourceMappingURL=ui.min.js.map